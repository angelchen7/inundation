---
title: "inundation_summary"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{annual_plots}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE, warning = FALSE, message = FALSE}
library(inundation)

```

These plots show the utility and explain the ecological relevance of the calc_summary function. The calc_summary function summarized the calc_inundation output over water year:

total_days_inund: total number of inundation days 
max_days_inund: maximum number of consecutive days of inundation 
first_date_inund: first date of inundation
last_date_inund: last date of inundation
last_date_overtopping: last date that the Fremont Weir was overtopped
number_overtopping_events: total number of inundation events

Note that total_days_inund will equal max_days_inund when there is a single inundation event within a water year. Also note that last_date_overtopping and last_date_inund may be equal when the floodplain drains quickly (e.g., there is no or limited western tributary input), and that the first_date_inund is also the first day of overtopping within a given water year because the calc_inundation function requires Fremont Weir overtopping to begin an inundation event. 

```{r, echo = FALSE, results = 'hide', message = FALSE}
#load data
inundation_summarised <- calc_summary()

```

The relationship between total_days_inund, max_days_inund and number_overtopping_events
```{r, echo = FALSE , warning = FALSE, message = FALSE}

plot(inundation_summarised$total_days_inund, inundation_summarised$max_days_inund, 
     cex = inundation_summarised$number_overtopping_events,
     xlab = "Total days of inundation per WY",
     ylab = "Max number of consecutive days of inundation per WY")

text(inundation_summarised$total_days_inund, inundation_summarised$max_days_inund-3, labels=inundation_summarised$water_year)

legend("topleft", c("Point size is proportional to the number of events", "Water year is written under the point"))
```

The relationship between last_date_inund and last_date_overtopping, which can be interpreted as the impact of small westside streams, such as Knight's Landing Ridge Cut, Cache Creek, and Putah Creek. Zero here means that inundation ended on the same date as overstopping of the Fremont Weir ended (e.g., when inputs from the Sacramento River end). Impacts of the Sacramento Weir overtopping is not included here, and does not seem to impact this relationship (most noticeably 1998, 2006 and 2017).
```{r, echo = FALSE , warning = FALSE, message = FALSE}
inund_dates <- na.omit(inundation_summarised[,c(1,4,6)])
inund_dates$diff <- inund_dates$last_date_inund-inund_dates$last_date_overtopping

plot(inund_dates$water_year, inund_dates$diff, 
     xlab = "Water year", ylab = "Difference (in days) between when the inundation and overtopping events end")

text(inund_dates$water_year, inund_dates$diff-1, labels=inund_dates$water_year)
```

Summary plot to show the complexity in how and when the Yolo Bypass floods
```{r, echo = FALSE , warning = FALSE, message = FALSE}
# plot by month of start and end inundation
inundation_summarised$f_month <- as.numeric(strftime(inundation_summarised$first_date_inund,"%m"))
inundation_summarised$l_month <-  as.numeric(strftime(inundation_summarised$last_date_inund,"%m"))

inundation_summarised$f_month <- factor(inundation_summarised$f_month, levels = c(12,1,2,3,4,5),  labels = c("Dec","Jan","Feb","Mar","Apr","May"))

inundation_summarised$l_month <- factor(inundation_summarised$l_month, levels = c(12,1,2,3,4,5,6,7,8,9),  labels = c("Dec","Jan","Feb","Mar","Apr","May","Jun", "Jul", "Aug", "Sep"))

# color ramp by as number of events
max(inundation_summarised$number_overtopping_events)
rbPal <- colorRampPalette(c('red','blue'))
inundation_summarised$number_overtopping_events <- as.numeric(inundation_summarised$number_overtopping_events)
inundation_summarised$Col <- rbPal(4)[as.numeric(cut(inundation_summarised$number_overtopping_events,breaks = 4))]

inundation_summarised$total_days_inund <- as.numeric(inundation_summarised$total_days_inund)

plot(as.numeric(inundation_summarised$f_month), as.numeric(inundation_summarised$l_month), cex = inundation_summarised$total_days_inund/10, col = alpha(inundation_summarised$Col, 0.4), xlim = c(0,6), xlab = "Month of inundation start", ylab = "Month of inundation end", xaxt = "n", yaxt = "n", pch = 16)

mtext(text = c("", "Dec","Jan","Feb","Mar","Apr","May"), outer = FALSE, side = 1, las = 1, at = 0:6, line =1)

mtext(text = c("Dec","Jan","Feb","Mar","Apr","May","Jun", "Jul", "Aug", "Sep"), outer = FALSE, side = 2, las = 1, at = 1:10, line =1)

legend("topleft", c("Point size is proportional to total inundation days", "1 event", "4 events"), pch = 16, col = c("white", "#FF0000", "#0000FF"))

#ggplot(inundation_summarised, aes(x = f_month, y = l_month, size = total_days_inund, col = number_overtopping_events)) + geom_point()

```

